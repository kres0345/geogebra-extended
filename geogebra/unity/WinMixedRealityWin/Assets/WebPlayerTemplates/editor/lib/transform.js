define(["require","exports","./function_helpers","../scripts/main"],function(t,e,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t){this.element=t}return t.prototype.getOriginCoords=function(t,e){return[[Number(t.left)-e.x,Number(t.top)-e.y,0,1],[Number(t.left)+Number(t.width)-e.x,Number(t.top)-e.y,0,1],[Number(t.left)+Number(t.width)-e.x,Number(t.top)+Number(t.height)-e.y,0,1],[Number(t.left)-e.x,Number(t.top)+Number(t.height)-e.y,0,1]]},t.prototype.coordsIn2D=function(t){for(var e=0;e<t.length;e++){var r=t[e][3];t[e][0]=t[e][0]/r,t[e][1]=t[e][1]/r,t[e][2]=0,t[e][3]=r/r}return t},t.prototype.getOriginInParent=function(t,e,r){var n=getComputedStyle(document.getElementById(r.id)),o=getComputedStyle(document.getElementById(r.parentElement.id)),i=n.transformOrigin.split(" "),s=o.transformOrigin.split(" ");"scene"===r.parentElement.id&&(s=["0px","0px"]);var a=/(-|[0-9\.0-9])+/g;return{x:parseFloat(t.left)+Number(i[0].match(a)[0])-Number(s[0].match(a)[0]),y:parseFloat(t.top)+Number(i[1].match(a)[0])-Number(s[1].match(a)[0])}},t.prototype.transform=function(t){var e=this.getPosition(t);t.transformed_position=e},t.prototype.getTranslationMatrix=function(t){var e=this.getElTranslation(t),r=new WebKitCSSMatrix;return r.m41=-e.x,r.m42=-e.y,r},t.prototype.getTransformedPos=function(t,e,n){for(;t.id!==e;){var o=new WebKitCSSMatrix(getComputedStyle(t).webkitTransform);o=o.inverse().multiply(this.getTranslationMatrix(t)).inverse(),n=this.coordsIn2D(this.getTrsnsformedPoints(r.default.parseMatrix(o,!0),n)),t=t.parentElement,this.getTransformedPos(t,e,n)}return n},t.prototype.getElTranslation=function(t){var e=n.default.selectedEditor,o=n.default.openFiles[e].runtimeEditor,i=o.mappedWidgets[t.id].widget,s=o.mappedWidgets[t.parentElement.id];s=s?s.widget:{};var a=r.default.getElementVertices(i),u=r.default.getElementVertices(s);return this.getOriginInParent(a,u,t)},t.prototype.getPosition=function(t){var e=r.default.getElementVertices(t),n=document.getElementById(t.id),o=r.default.getAbsolutePosition(n,"scene");Object.assign(e,o);var i=r.default.getTransformOrigin(e,t),s=this.getOriginCoords(e,i);return this.getTransformedPos(n,"scene",s)},t.prototype.getTrsnsformedPoints=function(t,e){for(var n=[],o=0;o<e.length;o++)n.push(r.default.multiply(t,e[o]));return n},t.prototype.getViewportPosition=function(t){var e=[];if(!t.transformed_position)return e;this.transform(t);for(var r=document.getElementById("scene"),n=$("#scene").offset(),o=$("#scene-wrapper").offset(),i=new WebKitCSSMatrix(window.getComputedStyle(r).webkitTransform),s=n.left-o.left,a=n.top-o.top,u=0;u<t.transformed_position.length;u++)e.push({x:t.transformed_position[u][0]*i.a+s,y:t.transformed_position[u][1]*i.a+a});return e},t}();e.default=o});