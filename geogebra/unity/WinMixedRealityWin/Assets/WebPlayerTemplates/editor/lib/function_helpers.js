define(["require","exports","./enums","../scripts/main","./editor_properties","./editor_settings","./common/filters_config","../scripts/helpers/units_conversion"],function(e,t,r,n,i,a,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={getTransformedElMaskPos:function(e){for(var t,r,n,i,a=0;a<e.transformed_position.length;a++){var o=e.transformed_position[a][0],s=e.transformed_position[a][1];t=void 0===t?s:t,r=void 0===r?o:r,n=void 0===n?s:n,i=void 0===i?o:i,t=s<t?s:t,r=o<r?o:r,n=s>n?s:n,i=o>i?o:i}return{top:t,left:r,height:n-t,width:i-r}},getTransformOrigin:function(e,t){var r=getComputedStyle(document.getElementById(t.id)).transformOrigin.split(" ");return{x:Number(r[0].match(/(-|[0-9\.0-9])+/g)[0])+Number(e.left),y:Number(r[1].match(/(-|[0-9\.0-9])+/g)[0])+Number(e.top)}},getElementVertices:function(e){if($.isEmptyObject(e))return{top:"0",left:"0",width:"0",height:"0",position:""};var t=document.getElementById(e.id),r=window.getComputedStyle(t,null).getPropertyValue("width"),n=window.getComputedStyle(t,null).getPropertyValue("height"),i=t.offsetTop+"px",a=t.offsetLeft+"px";return"%"===this.getUnitStyle(i)&&(i=s.default.convertUnitsToPixel(e.id,i,"top")),"%"===this.getUnitStyle(a)&&(a=s.default.convertUnitsToPixel(e.id,a,"left")),"%"===this.getUnitStyle(r)&&(r=s.default.convertUnitsToPixel(e.id,r,"width")),"%"===this.getUnitStyle(n)&&(n=s.default.convertUnitsToPixel(e.id,n,"height")),{top:this.getUnitValue(i),left:this.getUnitValue(a),width:this.getUnitValue(r),height:this.getUnitValue(n),position:t.style.position}},buildTransformStyles:function(e){var t="";for(var i in r.default.TransformsOrder){var o=r.default.TransformsOrder[i];e.transform[o]&&(t+=o+"("+e.transform[o]+") ")}return n.default.preferences.couiEnvironment===a.default.environment.Hummingbird&&(t=this.rebuildTransformForHb(t)),t},rebuildTransformForHb:function(e){var t=/scaleX\((.*?)\)/,r=/scaleY\((.*?)\)/,n=e.match(t),i=e.match(r);if(null!==n||null!==i){var a="scale";if(null!==n&&null!==i){a+="("+n[1]+", "+i[1]+")";o=n[0]+" "+i[0];e=e.replace(o,a)}else if(null!==n&&null===i){a+="("+n[1]+", 1)";o=""+n[0];e=e.replace(o,a)}else if(null===n&&null!==i){a+="(1, "+i[1]+")";var o=""+i[0];e=e.replace(o,a)}}var s=/rotateZ/;return null!==e.match(s)&&(e=e.replace(s,"rotate")),e},buildPerspectiveOriginStyles:function(e){var t="";for(var r in e.transform)"transform-origin-x"!==r&&"transform-origin-y"!==r&&(t+=r+"("+e.transform[r]+") ");return t},parseMatrix:function(e,t){for(var r=[[],[],[],[]],n=0,i=0,a=e instanceof Array?e.length:16,o=0;o<a;o++){0!==o&&o%Math.sqrt(a)==0&&(n=0,i++);var s=t?"m"+(i+1)+(n+1):o;r[n][i]=Number(e[s]),n++}return r},multiply:function(e,t){for(var r=[],n=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)n+=e[i][a]*t[a],r[i]=n;n=0}return r},areEqual:function(e,t){var r=0,n=e.length;if(n!==t.length)return!1;for(var i=0;i<n;i++){if(e[i]!==t[i])return!1;r++}return r===e.length},buildStringProps:function(e,t){e=t?this.sortArr(e):e;for(var r="",n=0;n<e.length;n++)r+=e[n];return r},hasValue:function(e,t){for(var r=-1,n=0;n<e.length;n++)if(e[n].match(t)){r=n;break}return r},sortArr:function(e,t){return e.sort(function(e,r){var n=e>r?1:-1;return t?-1*n:n})},getBoxShodowDefaults:function(){return{dropShadowBlur:o.default["-webkit-filter"].dropShadowBlur.default,dropShadowX:o.default["-webkit-filter"].dropShadowX.default,dropShadowY:o.default["-webkit-filter"].dropShadowY.default,dropShadowColor:o.default["-webkit-filter"].dropShadowColor.default}},buildDropShadowFiltersProps:function(e,t){var r=e.property,i=n.default.openFiles[n.default.selectedEditor].runtimeEditor;if("dropShadowBlur"===r||"dropShadowX"===r||"dropShadowY"===r||"dropShadowColor"===r){var a=t.replace(/\s/g,"").match(/([^\]+)( [^\)]+)/g),o="dropShadowColor"===r?a[0]+"("+a[1]+")":a[0];i.runtimeBuildDropShodowFilter[r]=o}},buildFilterProps:function(e,t){var r="",n=e.values;n=t?this.sortArr(n):n;for(var i=0;i<n.length;i++)r+=n[i];return r},isVoidElement:function(e){var t=e.tagName;return-1!==r.default.voidElements.indexOf(t)},notAllowedForAnimation:function(e,t){return r.default.notAllowedForAnimation[e]===t},validateId:function(e){var t=!1;return e.match(/[^a-zA-Z0-9_-]+/g)||(t=!0),t},validateAnimationName:function(e){var t=!1;return e.match(/^([a-zA-Z]|^[-](?=[a-zA-Z]))[a-zA-Z0-9_-]*/g)&&(t=!0),t},hasInChildren:function(e,t,r){for(var n=!1,i=0;i<e.length;i++)if(e[i][t]===r){n=!0;break}return n},rekickDomWebkitMasks:function(){for(var e=n.default.openFiles[n.default.selectedEditor].runtimeEditor.mappedWidgets,t=0,r=Object.keys(e);t<r.length;t++){var i=r[t];if(e[i].widget.styles.webkitMaskImage){var a=document.getElementById(i);a.style.maskImage=e[i].widget.styles.webkitMaskImage,a.style.maskRepeat=e[i].widget.styles.webkitMaskRepeat}}},getFromTimeline:function(e){return n.default.detachedAmnimationsHTML?$(n.default.detachedAmnimationsHTML).find(e):$(e)},shortenLongValue:function(e){var t,r,n=this.getUnitStyle(e);switch(n){case"deg":case"px":case"%":r=this.getUnitValue(e),t=parseInt(r)+n;break;case"vw":case"vh":case"vmax":case"vmin":case"rem":case"pt":r=this.getUnitValue(e),t=parseFloat(r).toFixed(1)+n;break;default:t=e}return t},getRandomNumber:function(e,t){return Math.random()*(t-e)+e},translateDataBindNames:function(e,t){var n=this;if(t){var i=r.default.DataBindingGroups[e].replace("data-","");return"bindClassToggle"===e?i=i.replace("bind-",""):"bindStyleBackgroundColor"===e?i=i.replace("bind-style-",""):"bindBackgroundImageUrl"===e&&(i=i.replace("bind-background-image-url","background-image")),i}if(r.default.DataBindingGroups[e])return e;var a=e.split("-").map(function(e){return n.capitalizeFirstLetter(e)}).join("").replace("Bind","bind");return"class-toggle"===e?a="bind"+a:"background-color"===e?a="bindStyle"+a:"background-image"===e&&(a="bind"+a+"Url"),a},stylesValueNormalizer:function(e){var t=/rgba\((\d.*?),\s*(\d.*?),\s*(\d.*?),\s*(\d.*?)\)/g,r=e.match(t);if(null!==r){var n=r[0].split(t);n="rgba("+parseInt(n[1])+","+parseInt(n[2])+","+parseInt(n[3])+","+parseFloat(n[4]).toFixed(1)+")",e=e.replace(r[0],n)}return e},convertColorValues:function(e){var t=/rgb\((\d+),\s*(\d+),\s*(\d+)\)/g,r=/#\b[0-9A-Fa-f]+\b/g,n=e.match(t);if(null!==n){var i=n[0].replace(")",",1)");i=i.replace("rgb(","rgba("),e=e.replace(n[0],i)}var a=e.match(r);if(null!==a){var o=a[0].replace("#","");o.length<6&&(o=o[0]+o[0]+o[1]+o[1]+o[2]+o[2]);var s="rgba("+parseInt(o.substring(0,2),16)+","+parseInt(o.substring(2,4),16)+","+parseInt(o.substring(4,6),16)+",1)";e=e.replace(a[0],s)}return e},getHighestDecimal:function(e,t){var r=(""+e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/),n=(""+t).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);if(!r||!n)return 0;var i=Math.max(0,(r[1]?r[1].length:0)-(r[2]?+r[2]:0)),a=Math.max(0,(n[1]?n[1].length:0)-(n[2]?+n[2]:0));return Math.max(i,a)},applyStylesToScene:function(e){var t,r=/^((?:#|\.|@)?[\sa-zA-Z+~*$>:=^#\"\'\.\[\]\[0-9\]-]+\s*(?:,\s*(?:#|\.)?[\sa-zA-Z+~*$>:=^#\"\'\.\[\]\[0-9\]-]+)*\s*(?={))/gm;return t=e.filter(function(e){return"string"==typeof e}).join("\n"),(t=t.split(r).map(function(e){return""!==e&&"{"!==e[0]?e.split(",").map(function(e){var t=e.trim();return"@font-face"===t?t+" ":"body"===t||"html"===t||"body, html"===t?"#scene ":"#scene "+t}).join(","):e}).join(""))+'\n#scene * {\n/*CSS transitions*/\n-o-transition-property: none !important;\n-moz-transition-property: none !important;\n-ms-transition-property: none !important;\n-webkit-transition-property: none !important;\ntransition-property: none !important;\n/*CSS animations*/\n-webkit-animation: none !important;\n-moz-animation: none !important;\n-o-animation: none !important;\n-ms-animation: none !important;\nanimation: none !important;\n}\n#scene point, #scene mask, #scene div[data-type="widget"]{\nbackground-color: transparent !important;\n}\n#scene div{\n-o-transform: none;\n-moz-transform: none;\n-ms-transform: none;\n-webkit-transform: none;\ntransform: none;\n}'},getBackgroundSize:function(e){var t,r=getComputedStyle(e),n=new Image,i=r.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),a=r.backgroundSize,o=[parseInt(r.width.replace("px",""),10),parseInt(r.height.replace("px",""),10)],s=[];if(n.src=i,t=n.width>n.height?n.width/n.height:n.height/n.width,a=a.split(" "),s[0]=a[0],s[1]=a.length>1?a[1]:"auto","cover"===a[0])o[0]>o[1]&&o[0]/o[1]>=t?(s[0]=o[0],s[1]="auto"):(s[0]="auto",s[1]=o[1]);else if("contain"===a[0])o[0]<o[1]?(s[0]=o[0],s[1]="auto"):o[0]/o[1]>=t?(s[0]="auto",s[1]=o[1]):(s[1]="auto",s[0]=o[0]);else for(var l=a.length;l--;)a[l].indexOf("px")>-1?s[l]=a[l].replace("px",""):a[l].indexOf("%")>-1&&(s[l]=o[l]*(a[l].replace("%","")/100));return"auto"===s[0]&&"auto"===s[1]?(s[0]=n.width,s[1]=n.height):(t="auto"===s[0]?n.height/s[1]:n.width/s[0],s[0]="auto"===s[0]?n.width/t:s[0],s[1]="auto"===s[1]?n.height/t:s[1]),{width:s[0],height:s[1]}},getSceneSizeByType:function(e,t,r){var n="",i="";switch(e){case"aspectRatio5_4":n="1000px",i="800px";break;case"aspectRatio4_3":n="800px",i="600px";break;case"aspectRatio16_10":n="1440px",i="900px";break;case"aspectRatio16_9":n="1600px",i="900px";break;case"aspectRatio16_9_full_hd":n="1920px",i="1080px";break;case"aspectRatio_custom":n=t+"px",i=r+"px"}return{type:e,width:n,height:i}},numKeys:function(e){return Object.keys(e).length},getObjects:function(e,t){var r=[];for(var n in e)e.hasOwnProperty(n)&&("object"==typeof e[n]&&n!==t?r=r.concat(this.getObjects(e[n],t)):n===t&&r.push(e[t]));return r},getSceneSize:function(){var e=n.default.openFiles[n.default.selectedEditor].runtimeEditor.scene,t=parseInt(e.sceneSize.height);return{width:parseInt(e.sceneSize.width),height:t}},getSceneFontSize:function(){return parseFloat(getComputedStyle($("#scene")[0],null)["font-size"])},isfirstUpload:function(e,t){return"image"===e?""===t.url.trim():"responsiveImage"===e?""===t.styles.backgroundImage.trim():void 0},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},toFixed:function(e,t){var r=Math.pow(10,t);return Math.floor(100*e/100*r)/r},isUndefined:function(e){return void 0===e},isEventName:function(e){return-1!==r.default.EventTypes.indexOf(e)},isDataBindingTypes:function(e){return-1!==r.default.DataBindingTypes.indexOf(e)},isTransformProperty:function(e){return-1!==r.default.TransformTypes.indexOf(e)},getTransformProperty:function(e,t){return e="rotateX"===t||"rotateY"===t||"rotateZ"===t||"skewX"===t||"skewY"===t?void 0!==e?e:"0deg":"scaleX"===t||"scaleY"===t||"scaleZ"===t?void 0!==e?e:"1":"transform-origin-x"===t||"transform-origin-y"===t?void 0!==e?e:"50%":void 0!==e?e:"0px"},shortenString:function(e){return e.length>20?(e=e.substring(0,20))+"...":e},backwardsShortenString:function(e,t){void 0===t&&(t=20);var r=e.length,n=e;return r>t?"..."+(n=n.substring(r-t,r)):e},doPolygonsIntersect:function(e,t){var r,n,i,a,o,s,l,u,d=[e,t];for(a=0;a<d.length;a++){var c=d[a];for(o=0;o<c.length;o++){var f=(o+1)%c.length,p=c[o],g=c[f],m={x:g.y-p.y,y:p.x-g.x};for(r=n=void 0,s=0;s<e.length;s++)i=m.x*e[s].x+m.y*e[s].y,(this.isUndefined(r)||i<r)&&(r=i),(this.isUndefined(n)||i>n)&&(n=i);for(l=u=void 0,s=0;s<t.length;s++)i=m.x*t[s].x+m.y*t[s].y,(this.isUndefined(l)||i<l)&&(l=i),(this.isUndefined(u)||i>u)&&(u=i);if(n<l||u<r)return!1}}return!0},calcElementTransformedMatrixCoords:function(e,t){for(var r={x:0,y:0};e.parentElement.id!==t;){var n=this.getElementAbsoluteTransform(e.parentElement,t),i=this.calcMatrixPoints(e,n);r.x+=i.x,r.y+=i.y,e=e.parentElement}return r},getElementAbsoluteTransform:function(e,t){var r=new WebKitCSSMatrix(window.getComputedStyle(e).webkitTransform);for("scene"===e.id&&(r.m41=0,r.m42=0);e.parentElement.id!==t;){var n=new WebKitCSSMatrix(window.getComputedStyle(e.parentElement).webkitTransform);"scene"!==e.parentElement.id&&"scene"!==e.id||(n.m41=0,n.m42=0),r=r.multiply(n),e=e.parentElement}return r},calcMatrixPoints:function(e,t){var r=t,n=parseFloat(getComputedStyle(e,null).getPropertyValue("border-left-width"))||0,i=parseFloat(getComputedStyle(e,null).getPropertyValue("border-top-width"))||0,a=e.offsetLeft+n,o=e.offsetTop+i,s=isNaN(a)?0:a,l=isNaN(o)?0:o,u=s-parseFloat(getComputedStyle(e.parentElement,null).getPropertyValue("width"))/2+parseFloat(getComputedStyle(e,null).getPropertyValue("width"))/2,d=l-parseFloat(getComputedStyle(e.parentElement,null).getPropertyValue("height"))/2+parseFloat(getComputedStyle(e,null).getPropertyValue("height"))/2,c=this.multiply(this.parseMatrix(r,!0),[u,d,0,1]);return{x:c[0]-u,y:c[1]-d}},firstToUpperCase:function(e){return e.substr(0,1).toUpperCase()+e.substr(1)},getFileType:function(e){var t=e.split(".").pop(),r=i.default[a.default.environment[n.default.preferences.couiEnvironment]].DefaultExtensions;return-1!==r.image.indexOf(t)?"image":-1!==r.video.indexOf(t)?"video":-1!==r.html.indexOf(t)?-1!==e.indexOf("widgets")&&"widget":-1!==r.style.indexOf(t)?"style":-1!==r.script.indexOf(t)?"script":-1!==r.font.indexOf(t)&&"font"},getFilename:function(e){var t=/[^\\|/|]+$/;return e.match(t)[0]},getTransformedCoordsGlobal:function(e,t,r,n,i){var a=this.parseMatrix(i,!0),o=document.getElementById("scene"),s=this.getAbsolutePosition(o,"coui-editor"),l={x:r-s.left,y:n-s.top,z:0,w:1},u={x:0,y:0,z:0},d={x:-10*a[0][0]+-10*a[0][1]+0*a[0][2]+1*a[0][3],y:-10*a[1][0]+-10*a[1][1]+0*a[1][2]+1*a[1][3],z:-10*a[2][0]+-10*a[2][1]+0*a[2][2]+1*a[2][3],w:-10*a[3][0]+-10*a[3][1]+0*a[3][2]+1*a[3][3]},c=0*a[0][0]+0*a[0][1]+1*a[0][2]+1*a[0][3],f=0*a[1][0]+0*a[1][1]+1*a[1][2]+1*a[1][3],p=0*a[2][0]+0*a[2][1]+1*a[2][2]+1*a[2][3],g=Math.sqrt(c*c+f*f+p*p);f/=g,p/=g;var m=(c/=g)*d.x+f*d.y+p*d.z,h=(c*u.x+f*u.y+p*u.z-m)/Math.sqrt(c*c+f*f+p*p),v=-(l.x*c+l.y*f+0*p+h)/(0*c+0*f+-1*p),b=window.mouseCoordsX-s.left,y=window.mouseCoordsY-s.top,w=-(b*c+y*f+0*p+h)/(0*c+0*f+-1*p),x=l.x*a[0][0]+l.y*a[0][1]+v*a[0][2]+1*a[0][3],S=l.x*a[1][0]+l.y*a[1][1]+v*a[1][2]+1*a[1][3];return{x:b*a[0][0]+y*a[0][1]+w*a[0][2]+1*a[0][3]-x,y:b*a[1][0]+y*a[1][1]+w*a[1][2]+1*a[1][3]-S}},getElementAbsoluteTransformV2:function(e){for(var t=[new WebKitCSSMatrix(window.getComputedStyle(e).webkitTransform)],r=document.getElementById("scene"),n=new WebKitCSSMatrix(window.getComputedStyle(r).webkitTransform);;){if("scene"===e.parentElement.id)break;t.push(new WebKitCSSMatrix(window.getComputedStyle(e.parentElement).webkitTransform)),e=e.parentElement}for(var i=t.length-1;i>0;i--)n=n.multiply(t[i]);return n.inverse()},getTransformedCoordsSkew:function(e,t,r,n){return{x:e-r,y:t-n}},getTransformedCoordsRotation:function(e,t,r){return{x:e*Math.cos(-r)-t*Math.sin(-r),y:e*Math.sin(-r)+t*Math.cos(-r)}},getAbsolutePosition:function(e,t){var r,n,i,a,o=0,s=0,l=3;for("scene"!==t&&(l=0);e&&e.id!==t;)r=parseFloat(getComputedStyle(e.parentElement,null).getPropertyValue("padding-left"))||0,n=parseFloat(getComputedStyle(e.parentElement,null).getPropertyValue("padding-top"))||0,i=parseFloat(getComputedStyle(e.parentElement,null).getPropertyValue("border-left-width"))||0,a=parseFloat(getComputedStyle(e.parentElement,null).getPropertyValue("border-top-width"))||0,o+=e.offsetLeft-r+i,s+=e.offsetTop-n+a,e=e.offsetParent;return{left:o-l,top:s-l}},rotationInfo:function(e,t){for(var r={rad:0,deg:0};"scene"!==e.id;){var n=window.getComputedStyle(e,null).getPropertyValue("-webkit-transform");if((n=n.match("matrix\\((.*)\\)"))&&void 0!==(n=n[1].split(","))[0]&&void 0!==n[1]&&(r.rad+=Math.atan2(n[1],n[0]),r.deg+=180*r.rad/Math.PI),"single"===t)break;e=e.parentElement}return r},findParents:function(e){for(;e.parentNode;){var t=e;if("scene"===(e=e.parentNode).id)return t}return null},timeFormatAnimations:function(e){var t=e%1e3,r=Math.floor(e/1e3%60);return Math.floor(e/6e4%60)+":"+r+"."+t},buildDropShadowProperty:function(e){return e.dropShadowColor?"drop-shadow("+e.dropShadowColor+" "+parseFloat(e.dropShadowX)+"px "+parseFloat(e.dropShadowY)+"px "+parseFloat(e.dropShadowBlur)+"px)":""},dropShadowPropsFix:function(e){var t,r,n=/(\(.*\))(.*?\))/,i=/(.*)(rgb.+\))/,a=e.match(n);return null===a?(a=e.match(i),t=a[2],r=a[1].substring(1).trim().split(" "),[r[0],r[1],r[2],r[3]]):(t=a[1],r=a[2].substring(0,a[2].length-1).trim().split(" "),{boxShadowX:r[0],boxShadowY:r[1],boxShadowColor:t,boxShadowBlur:r[2]})},getValuesFromFilterCssProperties:function(e){var t=/([^\]+)( [^\)]+)/g,r=this.cleanFilterString(e),n=r.clenedString.match(t)||[];for(var i in r.dropShadowProps)n.push(i),n.push(r.dropShadowProps[i]);return n},getValuesBoxshadow:function(e){var t=/((?:rgb|hsl)(?:a)?\(.+\))$|(#[0-9a-fA-F]{3,6})$|\b(\w+)$|([^ ]+)/gm,r=(e=e.trim()).match(t);return 5===r.length&&r.unshift("none"),["insetOutset",r[0],"horizontalLength",r[1],"verticalLength",r[2],"blurRadius",r[3],"spreadRadius",r[4],"color",r[5]]},splitCssStringProperties:function(e,t,r,i,a,o){var s=/(\D+)\((.*?)\)/,l=t.split(" ").map(function(e){return e.match(s)}).filter(function(e){return null!==e}).reduce(function(e,t){return e[t[1]]=t[2],e},{});l[i]="number"==typeof a?Math.round(10*a)/10:a;var u=[];Object.keys(l).sort().forEach(function(e,t){"dropShadowBlur"!==e&&"dropShadowColor"!==e&&"dropShadowX"!==e&&"dropShadowY"!==e&&u.push(e+"("+l[e]+")")});var d=u.join(" ");if("webkitFilter"===r){var c=n.default.openFiles[n.default.selectedEditor].runtimeEditor.mappedWidgets[e].widget["-webkit-filter"];d+=" "+this.buildDropShadowProperty(c)}return o(d.trim())},getBoxshadowObject:function(e){for(var t={},r=this.getValuesBoxshadow(e),n=0;n<r.length-1;n+=2)t[r[n]]=r[n+1];return t},getWebkitFilterObject:function(e){for(var t={},r=this.getValuesFromFilterCssProperties(e),n=0;n<r.length-1;n+=2)t[r[n]]=r[n+1];return t.rgba||t.rgb?(t.dropShadowColor=r[0]+"("+r[1]+")",delete t.rgba,delete t.rgb):t.dropShadowColor&&(t.dropShadowColor=r[1]+"("+r[2]+")"),t},mergeTransfromStyleProperties:function(e){for(var t=Object.keys(e),i="",a={},o=0;o<t.length;o++){var s=t[o];if(e[s]!==r.default.TransformDefaultValue[s])if("rotateX"===s||"rotateY"===s||"rotateZ"===s||"skewX"===s||"skewY"===s)i=i+s+"("+e[s]+") ";else if("transform-origin-x"===s||"transform-origin-y"===s)a[s]=e[s];else if("rotate"===s){var l=e[s];"rad"===this.getUnitStyle(l)&&(l=this.toDegrees(parseFloat(l))+"deg"),i=i+s+"("+l+") "}else if("scaleX"!==s&&"scaleY"!==s||"Hummingbird"!==n.default.preferences.couiEnvironment)i=i+s+"("+e[s]+") ";else{var u=e.scaleX||1,d=e.scaleY||1;i.match(/scale/)||(i=i+"scale("+u+", "+d+") ")}}var c={basic:i.trim(),origin:""};return(a["transform-origin-x"]||a["transform-origin-y"])&&(c.origin=(a["transform-origin-x"]||"50%")+" "+(a["transform-origin-y"]||"50%")),c},isBackgroundPositionString:function(e){return e+="",-1!==["center","top","bottom","left","right"].indexOf(e)},convertJsToCssProperty:function(e){return e.split(/(?=[A-Z])/).map(function(e){return"webkit"===e&&(e="-"+e),e.toLowerCase()}).join("-")},convertCssToJsProperty:function(e){var t=this,r=e.split(/[-]/).map(function(e){return t.capitalizeFirstLetter(e)});return r[0]=r[0].toLowerCase(),r.join("")},_mapWidgets:function(e,t){var r=this;return t=t||{},e.map(function(e){var i=0;if(void 0!==e.children&&e.children.length>0&&(i=e.children.length),void 0===e.id&&(e.id=n.default.generateRandomId(e.type),n.default.widgetCount++),t[e.id]={widget:e},i>0)return r._mapWidgets(e.children,t)}),t},getStringPropertyPercent:function(e){var t;switch(e){case"left":case"top":t="0%";break;case"center":t="50%";break;case"right":case"bottom":t="100%";break;default:t=e}return t},getUnitStyle:function(e){var t=/([a-zA-Z+%]+)/g,r=(e=""+e).match(t);return r?r.length>1?r[r.length-1]:"top"===r[0]||"left"===r[0]||"right"===r[0]||"bottom"===r[0]||"center"===r[0]||"initial"===r[0]||"inherit"===r[0]||"rgba"===r[0]||"blur"===r[0]||"invert"===r[0]?"":this.isBackgroundPositionString(r[0])?"%":r[0]:""},getColorValue:function(e){var t=/rgb.+\)|#.+/;return e instanceof Array?e[0].match(t):e.match(t)[0]},getUnitValue:function(e){if("center"===e||"bottom"===e||"left"===e||"right"===e||"0"===e.toString())return e;if(void 0!==e&&-1===e.indexOf("rgb")&&-1===e.indexOf("rgba")&&-1===e.indexOf("blur")&&-1===e.indexOf("invert")&&(e=""+e,!isNaN(parseFloat(e))||0===e.indexOf("rotate")||0===e.indexOf("blur"))){var t=/[^a-zA-Z%-()]+/;if(e.match(t))return e.match(t)[0]}return""},isInputValidNumber:function(e){if(e)return/^-?\d*\.?\d*$/.test(e)},patchInputNumberBehavior:function(e){var t,r=e.$this,n=e.currentWidget,i=e.propGroup,a=e.propKey;if(!0===this.isInputValidNumber(r.val()))t=r.val();else if(r.val()){if(!r.hasClass("units-number")||!r.val())return r.val();t=(t=parseFloat(n[i][a]).toFixed(1))||"",r.val(t)}else t=parseFloat(n[i][a]).toFixed(1);return t},cleanUrls:function(e){var t=/^coui:\/\/(?:uiresources\/)|(!?editor\/)|^coui:\/\/(?:editor\/)/,r=e.replace(t,"").replace(/editor\//,"");return r=r.replace(/^[^#]*?:\/\/.*?\/(.*)$/,"$1"),this.externalFilePathHandler(r,n.default.openFiles[n.default.selectedEditor].tab.filePath)},createLongPropertyGroup:function(e){if(""!==e.trim()){var t,r,i=/\(([^)]+)\)/,a=e.split(/ (?!\d)/),o={};for(var s in a)if(null!==(t=i.exec(a[s]))){r=a[s].split("(");var l=t[1];if("rotate"===r[0]||"rotateX"===r[0]||"rotateY"===r[0]||"rotateZ"===r[0]||"skewX"===r[0]||"skewY"===r[0])"rad"===this.getUnitStyle(l)&&(l=this.toDegrees(parseFloat(l))+"deg"),"rotate"===r[0]?o.rotateZ=l:o[r[0]]=l;else if("scale"===r[0]&&"Hummingbird"===n.default.preferences.couiEnvironment){var u=l.split(", ");o.scaleX=u[0],o.scaleY=u[1]}else o[r[0]]=l}return o}return{}},syncFiltersAnimations:function(e,t){var r=n.default.openFiles[n.default.selectedEditor].runtimeEditor,i=this.findNotAnimatedFiltersProperties(e,t);i.length>0&&(r.forceAutoKeyframes=!0,r._undoCreationStepsLength=i.length,i.map(function(t){var n=r.mappedWidgets[e].widget["-webkit-filter"][t];r.Animations.addKeyframe(e,"-webkit-filter",t,n,{offset:-4,seconds:0})}),r.forceAutoKeyframes=!1)},findNotAnimatedFiltersProperties:function(e,t){var r=n.default.openFiles[n.default.selectedEditor].runtimeEditor.scene.animations[e];if(!r)return[];var i=r[r.className].keyframes["-webkit-filter"];if(!i)return[];var a=[t];for(var o in i)o!==t&&a.push(o);var s=n.default.openFiles[n.default.selectedEditor].runtimeEditor.mappedWidgets[e].widget,l=[];for(var o in s["-webkit-filter"])l.push(o);return l.filter(function(e){return!a.includes(e)})},syncTransformAnimations:function(e,t){var r=n.default.openFiles[n.default.selectedEditor].runtimeEditor,i=this.findNotAnimatedTransformProperties(e,t);i.length>0&&(r.forceAutoKeyframes=!0,r._undoCreationStepsLength=i.length,i.map(function(t){var n=r.mappedWidgets[e].widget.transform[t];r.Animations.addKeyframe(e,"transform",t,n,{offset:-4,seconds:0})}),r.forceAutoKeyframes=!1)},findNotAnimatedTransformProperties:function(e,t){var r=n.default.openFiles[n.default.selectedEditor].runtimeEditor.scene.animations[e];if(!r)return[];var i=r[r.className].keyframes.transform;if(!i)return[];var a=[t];for(var o in i)o!==t&&a.push(o);var s=n.default.openFiles[n.default.selectedEditor].runtimeEditor.mappedWidgets[e].widget,l=[];for(var o in s.transform)l.push(o);return l.filter(function(e){return!a.includes(e)})},reorderTransform:function(e){var t=[];for(var n in e){t[n]=[];for(var i in r.default.TransformsOrder)for(var a=0;a<e[n].length;a++)r.default.TransformsOrder[i]===e[n][a].property&&t[n].push(e[n][a])}return t},createFilterPropertyGroup:function(e){var t=this.cleanFilterString(e),r=this.createLongPropertyGroup(t.clenedString);return $.extend(!0,r,t.dropShadowProps),r},modulateValue:function(e,t){return parseFloat(Math.cos(Math.PI*t).toFixed(2))*e},hasDropShadowProperty:function(e){return!!(e.dropShadowBlur||e.dropShadowColor||e.dropShadowX||e.dropShadowY)},cleanFilterString:function(e){var t=e,r=/(drop-shadow)(.*?\))(.*?\))/.exec(e),n={},i=[];if(null!==r){t=e.replace(r[0],"").trim();var a=r[3].length;")"!==r[3]?(r[3]=r[3].substr(0,a-1).trim(),i=r[3].split(" ")):i=this.dropShadowPropsFix(r[2]),n.dropShadowX=i[0],n.dropShadowY=i[1],n.dropShadowBlur=i[2];var o=this.getColorValue(r[2]);n.dropShadowColor=o}return{clenedString:t,dropShadowProps:n}},createBoxShadowPropertyGroup:function(e,t){var r={},n=["horizontalLength","verticalLength","blurRadius","spreadRadius","insetOutset"],i=t.split(" ");if(r.color=e+")",n.length!==i.length)for(var a=0;a<n.length;a++)r[n[a]]="insetOutset"===n[a]?"none":i[a];else for(var o=0;o<n.length;o++)r[n[o]]=i[o];return r},toDegrees:function(e){return e*(180/Math.PI)},toRadians:function(e){return e*(Math.PI/180)},getAnimationClassNames:function(e){for(var t=e.split(" "),r=n.default.openFiles[n.default.selectedEditor].runtimeEditor.scene.animationClasses,i=[],a=0;a<t.length;a++)r[t[a]]&&i.push(t[a]);return i[0]||""},doesClassNameExist:function(e,t){for(var r=e.split(" "),n=0;n<r.length;n++)if(r[n]===t)return!0;return!1},getAnimationClassesFromClassNames:function(e){for(var t=[],r=e.split(" "),i=n.default.openFiles[n.default.selectedEditor].runtimeEditor.scene.animationClasses,a=0;a<r.length;a++)i[r[a]]&&t.push(r[a]);return t},replaceAnimationName:function(e,t,r){if(!e)return r;var n=e.split(" ");if(""!==t)for(var i=0;i<n.length;i++)n[i]===t&&(n[i]=r);else this.doesClassNameExist(e,r)||n.push(r);return n.join(" ")},removeMoreThanOneAnimationClasses:function(e,t){var r=t.split(" ").filter(function(t){return e.indexOf(t)<0});return console.log(r),r.unshift(e[0]),r.join(" ")},exportJSON:function(){if(n.default.openFiles[n.default.selectedEditor].runtimeEditor.undoRedoScene("undo"),0===n.default.openFiles[n.default.selectedEditor].undo.length){var e={redo:n.default.openFiles[n.default.selectedEditor].redo,animationClasses:n.default.openFiles[n.default.selectedEditor].runtimeEditor.scene.animationClasses},t=JSON.stringify(e);n.default.onsave("*new0.html",t)}},moveWidget:function(e){if(e&&e.elementId&&e.moveDirection&&e.step&&void 0!==e.preserveUnits){var t,r,i,a,o=e.elementId,s=e.step,l=e.preserveUnits,u=n.default.openFiles[n.default.selectedEditor].runtimeEditor,d=u.mappedWidgets[o].widget;if(t="up"===e.moveDirection||"down"===e.moveDirection?"top":"left","down"!==e.moveDirection&&"right"!==e.moveDirection||(s*=-1),l)r=parseFloat(d.geometry[t]),"px"===(i=this.getUnitStyle(d.geometry[t]))&&(s*=10),a=(r-s).toFixed(1)+i,u._setGeometry(o,d,o,"geometry",t,a);else{var c=document.getElementById(o),f=document.body.querySelector('[data-widget-id="'+o+'"]'),p=c.offsetTop,g=c.offsetLeft;"top"===t?(c.style[t]=p-s+"px",f.style[t]=p-s+"px"):(c.style[t]=g-s+"px",f.style[t]=g-s+"px"),u.onInteractEnd(document.getElementById(o))}}},biggerClosest:function(e,t){for(var r=e.sort(function(e,t){return e-t})[e.length-1]||0,n=0;n<e.length;n++)e[n]>t&&e[n]<r&&(r=e[n]);return r},smallerClosest:function(e,t){for(var r=e.sort(function(e,t){return e-t})[0]||0,n=0;n<e.length;n++)e[n]<t&&e[n]>r&&(r=e[n]);return r},removeDuplicates:function(e){var t=[];return $.each(e,function(e,r){-1===$.inArray(r,t)&&t.push(r)}),t},countDecimals:function(e){var t=e.split(".")[1];return t?t.length:0},getFileAndPath:function(e){return{path:e.replace(/[^\/\\]*$/,"").replace(/'|"/gi,""),filename:e.replace(/^.*[\\\/]/,"").replace(/'|"/gi,"")}},pathHandler:function(e,t,r){var n=r.replace("coui://uiresources/","").replace(/(\/\/+)/g,"/"),i=e.replace("coui://uiresources/",""),a=t.replace(/\\/g,"/"),o=new RegExp("^"+a);if(i.match(o))n=n.replace(a,"").replace(/[^\/\\]*$/,"");else for(var s=a.split("/"),l=i.split("/"),u=l.length,d=0,c=0;c<u;c++){if(s[0]!==l[0]){n="../".repeat(d||s.length-1)+l.join("/");break}s[0]===l[0]&&(l=l.slice(c+1),s=s.slice(c+1),d++)}return n},pathChanger:function(e){var t=e.regGroup;if(e.regGroup.match(/\.\.\//)){var i=e.regGroup.split("../").length-1,a=e.path.split("/"),o=e.path.split("/").slice(0,i).join("/");e.regGroup=e.regGroup.split("../").join("").replace(/'/g,""),t=a.length-1===i?e.regGroup:o+"/"+e.regGroup}else e.regGroup=e.regGroup.replace(/'/g,""),t=""+e.path+e.regGroup;return e.isResponsive?n.default.globalEditorInfo.backend===r.default.Backends.Debug||n.default.globalEditorInfo.backend===r.default.Backends.Website?"url('uiresources/"+t+"')":"url('coui://uiresources/"+t+"')":e.isFont?"'"+t+"'":'src="'+t+'"'},openPathHandler:function(e,t){var n=this,i=e.split('<script class="global-events">'),a=i[0].replace(/url\((.*?)\)/gi,function(e,i){if(e.match(/&quot;/))return e;var a=i.replace(/'/g,""),o=a.split(".").pop();return o===r.default.extensions.ttf||o===r.default.extensions.ttf?n.pathChanger({regGroup:a,path:t,isFont:!0}):n.pathChanger({regGroup:a,path:t,isResponsive:!0})}).replace(/src="(.*?)"/gi,function(e,i){return i.split(".").pop()===r.default.extensions.js?n.jsFileHandler(i,t):n.pathChanger({regGroup:i,path:t})}).replace(/<link.*href="([coui:\/\/]|.*?)">/gi,function(e,r){return'<link rel="stylesheet" type="text/css" class="styles" href="'+n.assetPathHandler(r,t)+'">'});return i[1]?a+'<script class="global-events">'+i[1]:a},rootFolder:function(e){return e.split(/[\/\\]/)[0]},externalFilePathHandler:function(e,t){var r=e.replace("!css",""),n=t.replace(/\\/g,"/"),i=this.getFileAndPath(e).path,a=this.getFileAndPath(e).filename,o=new RegExp("^"+n),s=i.split("/"),l=n.split("/"),u=l.length,d=0;if(i.match(o))r=r.replace(t,"");else for(var c=0;c<u;c++){if(l[c]!==s[c]){r="../".repeat(d||l.length-1)+s.join("/")+a;break}l[c]===s[c]&&(s=s.slice(c+1),l=l.slice(c+1),d++)}return r},checkFilePaths:function(e,t,r){for(var n=e.replace(/\?+.*/,""),i=t.replace(/\?+.*/,""),a=e.replace(/[^\/\\]*$/,"").split("../").length-1,o=r.split("/").slice(0,-1),s=0;s<a;s++)o=o.slice(0,-1);return""===o.join("/")?n.replace(/\.\.\//g,"")===i:o.join("/")+"/"+n.replace(/\.\.\//g,"")===i},buildPublishPage:function(e,t){function r(e){$(e).each(function(e,a){if(a.attributes&&a.hasAttribute("style")){var o=a.getAttribute("style"),s="coui-style-"+i;a.removeAttribute("style"),a.removeAttribute("data-type"),a.removeAttribute("data-element-type"),a.removeAttribute("data-element-selectable"),i++,a.classList.add(s);var l=o;"Hummingbird"===t&&(l=(l=(l=(l=(l=l.replace(/(?:flex-flow:|-webkit-flex-flow:)(.*?);/gm,function(e,t){var r=t.trim().split(" ");return"flex-direction: "+r[0]+";"+" "+("flex-wrap: "+r[1]+";")})).replaceAll("inline-block","block")).replaceAll(" -webkit-user-select: none;","")).replaceAll("-webkit-","")).replace(/.mask:.*?;/gm,function(e){var t=" mask-image: ";return t+=e.match(/url\(.*?\)/)[0]+"; mask-position: ",t+=e.match(/\).*?\//)[0].replace(") ","").replace(" /","")+"; mask-repeat: ",t+=e.match(/(repeat|no-repeat).*?;/)[0]})),l=l.replaceAll(";",";\n"),n+="."+s+" {\n "+l+" }\n"}a.childNodes.length>0&&r(a.childNodes)})}var n="",i=0;return r(e),{cleanedHTML:e.innerHTML,css:n}},jsFileHandler:function(e,t){return'src="'+this.assetPathHandler(e,t)+'"'},assetPathHandler:function(e,t){for(var r=this.getFileAndPath(e).path.match(/(\.\.\/)/g),n=r?r.length:0,i=t.split("/").filter(Boolean),a=0;a<n;a++)i.length>0&&(i=i.slice(0,-1));return i.length>0?i.join("/")+"/"+e.replace(/\.\.\//g,""):e.replace(/\.\.\//g,"")},removeSlashes:function(e){var t=[];return t[0]=e[0].split("/").join(""),t[1]=e[1].split("\\").join(""),t},getTextSelection:function(e){return{start:e.selectionStart,end:e.selectionEnd}},cleanBackgroundUrls:function(e){var t=/\(([\s\S]*)\)/;try{var r=e.match(t)[1].replace("'","");if(r.length>20){var n=r.length;return"..."+(r=r.substring(n-20,n))}return r}catch(t){return e}},disableKendoInput:function(e){$('input[data-property-key="'+e+'"]').attr("disabled",!0),$('input[data-property-key="'+e+'"]').val(0)},enableKendoInput:function(e){$('input[data-property-key="'+e+'"]').attr("disabled",!1)},buildFontCss:function(e){return"@font-face {\n\tfont-family: "+e.replace(/\.[^/.]+$/,"").replace(/^.*[\\\/]/,"")+";\n\tsrc: url("+e+");\n}\n"},fontIsPresent:function(e,t){return t.map(function(e){return e.replace(/\.[^/.]+$/,"").replace(/^.*[\\\/]/,"")}).concat(["inherit"]).includes(e)},transformMaskSize:function(e){var t=e.split(": ")[0],r=e.split(": ")[1].replace(";","");return"auto"!==r&&(r=this.maskSizeFormat(r)),t+": "+r+";"},maskSizeFormat:function(e){return e.match(/\s/g)||"contain"===e||"cover"===e||"inherit"===e?e:e+" "+e},getHBScaleProperties:function(e){return(e.transform.scaleX||1)+", "+(e.transform.scaleY||1)},getWidgetComplexProp:function(e,t,r,n){return e[r]?e[r][t]||n:n},getWidgetState:function(e,t,n){var i;if(["styles","geometry"].includes(n))return e[n][t];if("-webkit-filter"===n)return this.getWidgetComplexProp(e,t,n,r.default["-webkit-filterDefaultValues"][t]);if("transform"===n)return this.getWidgetComplexProp(e,t,n,r.default.TransformDefaultValue[t]);if("transform-origin"===n)return this.getWidgetComplexProp(e,t,n,0);if("dataBindings"===n)return t=this.translateDataBindNames(t,!1),this.getWidgetComplexProp(e,t,n,"");switch(t){case"id":i=e.id;break;case"className":i=e.className;break;case"data-l10n-id":i=e.attrs["data-l10n-id"];break;case"src":"attrs"===n&&(i=e.attrs.src);break;case"min":case"max":case"value":case"step":"attrs"===n&&(i=e.attrs[t]);break;case"placeHolder":i=e.attrs.placeHolder;break;default:i=""}return i},isComponent:function(e){return!!e.widgetkit&&"component"===/(?:\.([^.]+))?$/.exec(e.widgetkit)[1]}}});