define(["require","exports","../scripts/main","./function_helpers","./transform"],function(e,t,o,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){function t(e){h=!1,(w=$(".selection-drag")).addClass("active"),u=g.offset().top,p=g.offset().left,c=e.pageX,f=e.pageY,w.css({left:e.pageX-p,top:e.pageY-u}),g.bind("mouseup",S),g.bind("mousemove",r)}function r(e){y=!0;var t=Math.abs(c-e.pageX),o=Math.abs(f-e.pageY);w.css({width:t,height:o}),e.pageX<=c&&e.pageY>=f?w.css({left:e.pageX-p}):e.pageY<=f&&e.pageX>=c?w.css({top:e.pageY-u}):e.pageY<f&&e.pageX<c&&w.css({left:e.pageX-p,top:e.pageY-u})}function i(e,t){var r=s(e[0]),i=o.default.selectedEditor,d=o.default.openFiles[i].runtimeEditor,u=new a.default,p=d.mappedWidgets[t[0].id].widget,c=u.getViewportPosition(p),f=c.length?c:l(t[0]);return n.default.doPolygonsIntersect(f,r)}function d(e,t,o,n,a){var r=o.m11*e+-o.m12*t,i=-o.m21*e+o.m22*t;return r=n+r,i=a+i,{x:r,y:i}}function s(e){var t=parseFloat(window.getComputedStyle(e,null).getPropertyValue("width")),o=parseFloat(window.getComputedStyle(e,null).getPropertyValue("height")),n=e.offsetTop,a=e.offsetLeft,r=a+t,i=n+o;return[{x:a,y:n},{x:r,y:n},{x:r,y:i},{x:a,y:i}]}function l(e){var t=document.getElementById("scene"),o=new WebKitCSSMatrix(window.getComputedStyle(t).webkitTransform),a=parseFloat(window.getComputedStyle(e,null).getPropertyValue("width")),r=parseFloat(window.getComputedStyle(e,null).getPropertyValue("height")),i=new WebKitCSSMatrix(window.getComputedStyle(e).webkitTransform);i=i.multiply(o);var s=n.default.getAbsolutePosition(e,"scene-wrapper"),l=s.left,u=s.top,p=n.default.calcElementTransformedMatrixCoords(e,"scene-wrapper"),c=a/2,f=r/2,g=(l+=p.x+o.e)+c,m=(u+=p.y+o.f)+f,w=-f,h=-c,y=c,v=f,b={topLeft:d(h,w,i,g,m),topRight:d(y,w,i,g,m),bottomLeft:d(h,v,i,g,m),bottomRight:d(y,v,i,g,m)};return[b.topLeft,b.topRight,b.bottomRight,b.bottomLeft]}var u,p,c,f,g,m,w,h=!1,y=!1,v=function(){function e(){}return e.prototype.init=function(){g=$("#top-scene-holder"),m=$("#scene")},e.prototype.getSelectedState=function(){return h},e.prototype.setSelectedState=function(e){h=e},e.prototype.detachHandlers=function(){g[0].removeEventListener("mousedown",t,!1),g[0].removeEventListener("mousedown",b,!1)},e.prototype.attachHandlers=function(){this.detachHandlers(),g[0].addEventListener("mousedown",t,!1),g[0].addEventListener("mousedown",b,!1)},e}();e.WidgetSelection=v;var b=function(e){var t=e.target,n=t.dataset,a=o.default.selectedEditor,r=o.default.openFiles[a].runtimeEditor;n.elementSelectable&&"true"===n.elementSelectable?r.selectJstreeItem(t.id):n.parentWidgetId?r.selectJstreeItem(n.parentWidgetId):"scene"!==t.id&&"scene-wrapper"!==t.id||r.clearSelectedElements()},S=function(e){if(g.unbind("mousemove",r),g.unbind("mouseup",S),y){var t=[];$('[data-element-selectable="true"][data-element-type="widget"]').each(function(){var e=$(this);i(w,e)&&t.push(e[0].id)});var n=o.default.selectedEditor;o.default.openFiles[n].runtimeEditor.selectMultiJstreeItems(t)}w.removeClass("active"),w.width(0).height(0),y=!1}}(r||(r={})),t.default=r});