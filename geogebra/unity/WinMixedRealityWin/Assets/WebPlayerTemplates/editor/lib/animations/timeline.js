define(["require","exports","../enums","../function_helpers","../../scripts/main"],function(e,t,i,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r,s,l=e("lib/animations/hbs/tooltip_options.hbs!text"),d=2.5,m=null,c=function(){function e(e){this.$timelineEl=$(".timeline"),this.$timelineWrap=$(".timeline-wrap"),this.$animTimeEl=$(".animation-timeline"),this.$pin=$("#timeline-pin"),this.$ruler=$("#timeline-ruler"),this.$timelineInput=$("#timeline-input"),this.$infoWidgetsSection=$(".info-stack"),this.timelineWidth=2e3,this.timelineZoom=d,this.originalRulerWidth=2e3,this.pinCurrentSeconds=0,this.currentSeconds=0,this.oldPinheadSeconds=0,this.pinHalfWidth=4,this.runtimeEditor=e,this.templateWidgetLine=document.getElementById("widget-line-html"),this.templateTimelineInfo=document.getElementById("timeline-info"),this.dragFlag=!1,this.animationSearchValue="",this.timelineInputHandler()}return e.prototype.create=function(){this.$timelineEl.off("mousewheel"),this.selectKeyframeHandlers(),this.draggingPointsHandlers(),this.createTimeline(),this.zoomHandler(),this.timelineScrollHandler()},e.prototype.getPinTime=function(){return{offset:this.$pin[0].offsetLeft,seconds:this.pinCurrentSeconds}},e.prototype.zoomHandler=function(){var e=this;this.$timelineEl.off("mousewheel"),this.$timelineEl.on("mousewheel",function(t){t.preventDefault();var i=t.delta||t.originalEvent.wheelDelta,n=i?i<0:t.originalEvent.deltaY>0,a=e.$pin[0].offsetLeft;if(!(!n&&e.timelineZoom>=4||n&&e.timelineZoom<=1)){e.zoom(n),e.createTimeline();var o=e.$pin[0].offsetLeft-a;e.$pin[0].offsetLeft>0&&e.rulerScrollRight(o)}})},e.prototype.zoom=function(e){var t=this,o=e?1:0,r=.1*+!o-.1*o,s=(this.timelineZoom+r)/this.timelineZoom;this.timelineZoom+=n.default.toFixed(r,2),$(".dragging-point").each(function(){var e=$(this)[0].offsetLeft*s;a.default.globalEditorInfo.backend!==i.default.Backends.Debug&&a.default.globalEditorInfo.backend!==i.default.Backends.Website&&a.default.globalEditorInfo.backend!==i.default.Backends["Standalone-2"]&&(e+=.5),t.renderPoint(e,$(this))})},e.prototype.extendTimeline=function(){this.timelineWidth=this.originalRulerWidth*this.timelineZoom,this.setTimelineWidth(this.timelineWidth)},e.prototype.setTimelineWidth=function(e){this.$ruler.attr("width",e),this.$timelineEl[0].style.width=e+"px"},e.prototype.createTimeline=function(){this.extendTimeline();var e=this.$ruler[0].getContext("2d");this.timelinePositions({render:e})},e.prototype.createWidgetLines=function(){var e=n.default.getFromTimeline(".keyframes-line")[0].getContext("2d");e.beginPath(),this.timelinePositions({render:e})},e.prototype.timelinePositions=function(e,t){for(var i=0,a=n.default.toFixed(this.timelineWidth,2),o=0;o<a;o+=10*this.timelineZoom,i+=100)e.render&&this.renderTimeline(e.render,o,i),e.calcTimePosition&&this.calcTimePosition(e.calcTimePosition,o,10,i,100,t);return i},e.prototype.renderTimeline=function(e,t,i){e.font="10px Helvetica, sans-serif",e.fillStyle="#fff",i%1e3==0?(e.beginPath(),e.moveTo(t,0),e.lineTo(t,16),e.strokeStyle="#fff",e.stroke(),e.fillText(i,t+3,10)):this.timelineZoom>1&&i%500==0?(e.beginPath(),e.moveTo(t,0),e.lineTo(t,8),e.strokeStyle="#fff",e.stroke(),e.fillText(i,t+3,10)):this.timelineZoom>2&&i%100==0?(e.beginPath(),e.moveTo(t,0),e.lineTo(t,5),e.strokeStyle="#fff",e.stroke()):this.timelineZoom>3&&i%50==0&&(e.beginPath(),e.moveTo(t,0),e.lineTo(t,5),e.strokeStyle="#fff",e.stroke())},e.prototype.renderPoint=function(e,t){e<0&&(e=-4),t.css("left",e)},e.prototype.getKeyframeWidgetData=function(e){var t=e[0].attributes["data-animation-class"].value,i=e[0].attributes["data-current-time"].value,n=e[0].attributes["data-keyframe-widget-id"].value,a=e[0].attributes["data-keyframe-group"].value,o=e[0].attributes["data-keyframe-property"].value;return{className:t,time:i,id:n,group:a,prop:o,value:this.runtimeEditor.scene.animationClasses[t].keyframes[a][o][i].values[0]}},e.prototype.selectKeyframe=function(e){var t=this.getKeyframeWidgetData(e),i=this.runtimeEditor.currentElementsSelection;0!==i.length&&i[0]===t.id||this.runtimeEditor.selectJstreeItem(t.id),n.default.getFromTimeline("div[data-keyframe-widget-id]").removeClass("keyframe-pressed"),e.addClass("keyframe-pressed");var a=e.attr("data-keyframe-widget-id");this.toggleElementTimeline($("#"+a),!0),$(".breadcrumb").html('<span class="keyframe-info-text"><b>Animated element: </b></span>'+t.id+'<span class="keyframe-info-text">&nbsp&nbsp<b> property: </b></span> '+t.prop+'<span class="keyframe-info-text">&nbsp&nbsp<b> value: </b></span>'+t.time)},e.prototype.unselectAllKeyfames=function(){n.default.getFromTimeline("div[data-keyframe-widget-id]").removeClass("keyframe-pressed"),this.runtimeEditor.selectedKeyframes.length=0},e.prototype.unhighlightAllTracks=function(){n.default.getFromTimeline("div[data-timeline-info-widget-id] > div").removeClass("element-track-selected"),n.default.getFromTimeline("div[data-timeline-info-widget-id] > div > .info-widget-name").removeClass("element-track-selected"),n.default.getFromTimeline("div[data-widget-id] > .keyframe-line").removeClass("element-track-selected"),n.default.getFromTimeline("div[data-timeline-info-widget-id] > .info-class-name").removeClass("class-track-selected"),n.default.getFromTimeline("div[data-widget-id] > .keyframe-line-class-name").removeClass("class-track-selected"),n.default.getFromTimeline("div[data-timeline-info-widget-id] > .info-property-name").removeClass("track-selected"),n.default.getFromTimeline("div[data-widget-id] > div > .selectable-track").removeClass("track-selected"),n.default.getFromTimeline("div[data-timeline-info-widget-id] > div > .animation-class-name-input").removeClass("input-track-selected")},e.prototype.selectKeyframeHandlers=function(){var e=this;n.default.getFromTimeline(".dragging-point").off("mousedown"),n.default.getFromTimeline(".dragging-point").on("mousedown",function(t){e.runtimeEditor.blurOutTextInputs(),"timeline-pin"!==$(this)[0].id&&(e.selectKeyframe($(this)),e.runtimeEditor.selectedKeyframes[0]=$(this))}),$("html").off("click"),$("html").on("click",function(t){e.dragFlag&&(e.dragFlag=!1)})},e.prototype.toggleElementTimeline=function(e,t){var i=e.attr("id"),a=document.getElementById("anim-option-"+i);t?(n.default.getFromTimeline('div[data-timeline-info-widget-id="'+i+'"] > div').addClass("element-track-selected"),n.default.getFromTimeline('div[data-timeline-info-widget-id="'+i+'"] > div > .info-widget-name').addClass("element-track-selected"),n.default.getFromTimeline('div[data-widget-id="'+i+'"] > .keyframe-line').addClass("element-track-selected"),n.default.getFromTimeline('div[data-timeline-info-widget-id="'+i+'"] > .info-class-name').addClass("class-track-selected"),n.default.getFromTimeline('div[data-widget-id="'+i+'"] > .keyframe-line-class-name').addClass("class-track-selected"),n.default.getFromTimeline('div[data-timeline-info-widget-id="'+i+'"] > .info-property-name').addClass("track-selected"),n.default.getFromTimeline('div[data-widget-id="'+i+'"] > div > .selectable-track').addClass("track-selected"),n.default.getFromTimeline('div[data-timeline-info-widget-id="'+i+'"] > div > .animation-class-name-input').addClass("input-track-selected"),null!==a&&a.scrollIntoView({block:"start",behavior:"smooth"})):(n.default.getFromTimeline('div[data-timeline-info-widget-id="'+i+'"] > div').removeClass("element-track-selected"),n.default.getFromTimeline('div[data-timeline-info-widget-id="'+i+'"] > div > .info-widget-name').removeClass("element-track-selected"),n.default.getFromTimeline('div[data-widget-id="'+i+'"] > .keyframe-line').removeClass("element-track-selected"),n.default.getFromTimeline('div[data-timeline-info-widget-id="'+i+'"] > .info-class-name').removeClass("class-track-selected"),n.default.getFromTimeline('div[data-widget-id="'+i+'"] > .keyframe-line-class-name').removeClass("class-track-selected"),n.default.getFromTimeline('div[data-timeline-info-widget-id="'+i+'"] > .info-property-name').removeClass("track-selected"),n.default.getFromTimeline('div[data-widget-id="'+i+'"] > div > .selectable-track').removeClass("track-selected"),n.default.getFromTimeline('div[data-timeline-info-widget-id="'+i+'"] > div > .animation-class-name-input').removeClass("input-track-selected"))},e.prototype.draggingPointsHandlers=function(){var e,t=this,i=[];n.default.getFromTimeline(".dragging-point").kendoDraggable({group:"keyframesGroup",hint:function(e){var t=(s=e).attr("data-current-time"),n=s.attr("data-keyframe-group"),a=s.attr("data-keyframe-property"),o=s.attr("data-animation-class");return i=$('[data-current-time="'+t+'"][data-keyframe-group="'+n+'"][data-keyframe-property="'+a+'"][data-animation-class="'+o+'"]'),e.clone().addClass("ob-clone")},drag:function(e){var i=e.clientX;"timeline-pin"!==s[0].id&&(t.runtimeEditor.selectedKeyframes[0]=s,t.dragFlag=!0),i>o-60?null===m&&(m=setInterval(t.rulerScrollRight.bind(t),5)):i<r.left?null===m&&(m=setInterval(t.rulerScrollLeft.bind(t),5)):(clearInterval(m),m=null);var n=t.$timelineWrap.scrollLeft(),a=parseFloat($(".ob-clone")[0].style.left)-r.left+n;"timeline-pin"===s[0].id&&(t.moveTimePoint(s,a),t.setTimelineInput(t.currentSeconds))},dragstart:function(i){t.runtimeEditor._sceneActionState.primaryAction="new action",o=$(document).width(),r=$("#horizontal-timeline-splitter .k-splitbar").offset(),s.addClass("ob-hide"),$("mask.select-corners").hide(),$(".transform-origin-point").hide(),e=t.runtimeEditor.currentElementsSelection,t.runtimeEditor._sceneActionState.draggingTimelinePin=!0},axis:"x",container:t.$timelineWrap,dragend:function(n){var a=t.$timelineWrap.scrollLeft(),o=parseFloat($(".ob-clone")[0].style.left)-r.left+a;if(clearInterval(m),m=null,t.runtimeEditor._sceneActionState.draggingTimelinePin=!1,"timeline-pin"!==s[0].id){t.runtimeEditor._undoCreationStepsLength=i.length;for(var l=0;l<i.length;l++)t.moveTimePoint($(i[l]),o);t.selectKeyframe(s)}else t.moveTimePoint(s,o),t.setTimelineInput(t.currentSeconds);$("mask.select-corners").show(),$(".transform-origin-point").show(),e.length>0&&t.runtimeEditor.highlightSelectedEl(null,e),t.runtimeEditor.exportScene()}}),$("body").kendoDropTarget({group:"keyframesGroup",drop:function(e){var t=$(".ob-clone");t.css("visibility","hidden");var i=t.offset();$(e.draggable.currentTarget).removeClass("ob-hide").offset(i)}}),this.$animTimeEl.off("click"),this.$animTimeEl.on("click",function(e){t.runtimeEditor.blurOutTextInputs(),"timeline-ruler"===e.target.id&&(t.setPinheadPosition(e.offsetX),t.setTimelineInput(t.currentSeconds))})},e.prototype._getKeyframeOffsets=function(){for(var e=n.default.getFromTimeline(".keyframe"),t=[],i=0;i<e.length;i++)t.push(e[i].offsetLeft);return t=t.sort(function(e,t){return e-t})},e.prototype._getTimelinePositions=function(){var e=n.default.getFromTimeline(".dragging-point")[0].offsetLeft,t=this._getKeyframeOffsets();return{pin:e,keyframes:n.default.removeDuplicates(t)}},e.prototype.setToNextKeyframe=function(){var e=this._getTimelinePositions();if(e.keyframes.length>0){var t=n.default.biggerClosest(e.keyframes,e.pin),i=this.convertOffsetXToTime(t);this.setTimelineInput(i),this.setPinheadPosition(t)}},e.prototype.setToPreviousKeyframe=function(){var e=this._getTimelinePositions();if(e.keyframes.length>0){var t=n.default.smallerClosest(e.keyframes,e.pin),i=this.convertOffsetXToTime(t);this.setTimelineInput(i),this.setPinheadPosition(t)}},e.prototype.setToFirstKeyframe=function(){var e=this._getKeyframeOffsets()[0];if(e){var t=this.convertOffsetXToTime(e);this.setTimelineInput(t),this.setPinheadPosition(e)}},e.prototype.setToLastKeyframe=function(){var e=this._getKeyframeOffsets(),t=e[e.length-1];if(t){var i=this.convertOffsetXToTime(t);this.setTimelineInput(i),this.setPinheadPosition(t)}},e.prototype.revertPinheadPosition=function(){this.setTimelineInput(this.oldPinheadSeconds),this.setPinheadPosition(0,this.oldPinheadSeconds)},e.prototype.convertTimeToOffsetX=function(e){return e/10*this.timelineZoom-this.pinHalfWidth},e.prototype.convertOffsetXToTime=function(e){var t=10*e/this.timelineZoom-this.pinHalfWidth;return this.formatTimelineInputValue(t)},e.prototype.getLastKeyframeTime=function(){var e=null;return n.default.getFromTimeline(".keyframe").each(function(){var t=parseInt($(this).attr("data-current-time"));(null===e||t>e)&&(e=t)}),e||!1},e.prototype.doTimerTimeout=function(e,t,n,a,o){function r(){if(m++===l&&o===i.default.animationPreviewType.endlessPreview)a(l,m);else{n(l,m);var e=(new Date).getTime()-c-m*d;s.runtimeEditor.iframe?window.setTimeout(r,d-e):a(l,m)}}var s=this,l=e/100*(t/10),d=e/l,m=0,c=(new Date).getTime();window.setTimeout(r,d)},e.prototype.doTimerAnimationFrame=function(e,t,n,a){function o(d){l||(l=d);var m=d-l,c=e/m*(s/r.timelineZoom);t(c),(m<e||a===i.default.animationPreviewType.endlessPreview)&&r.runtimeEditor.iframe?(requestAnimationFrame(o),r.setTimelineInput(m)):n()}var r=this,s=r.timelineZoom,l=null;requestAnimationFrame(o)},e.prototype.animatePinhead=function(e,t){var i=this,a=this.convertTimeToOffsetX(e),o=0,r=n.default.getFromTimeline("#timeline-pin");this.doTimerAnimationFrame(e,function(e){o=a/e,r.css("left",o)},function(){i.revertPinheadPosition()},t)},e.prototype.setPinheadPosition=function(e,t){void 0!==t&&(this.oldPinheadSeconds=this.currentSeconds,this.currentSeconds=t,e=this.convertTimeToOffsetX(t)),this.runtimeEditor._sceneActionState.draggingTimelinePin=!0,this.moveTimePoint(this.$pin,e),this.runtimeEditor._sceneActionState.draggingTimelinePin=!1,this.runtimeEditor.currentElementsSelection.length>0&&!a.default.EXPORTING_COMPONENT&&!a.default.EXPORTING_WIDGET&&this.runtimeEditor.highlightSelectedEl(null,this.runtimeEditor.currentElementsSelection)},e.prototype.moveTimePoint=function(e,t){var i=parseFloat(e.attr("data-current-time"))||0;this.timelinePositions({calcTimePosition:t},e),"timeline-pin"!==e[0].id?this.runtimeEditor.Keyframes.onKeyframeChange(e,i,this.currentSeconds):this.runtimeEditor.Keyframes.TimelineScrub.renderKeyframesInTime(i,this.currentSeconds),e.attr("data-current-time",this.currentSeconds)},e.prototype.timelineScrollHandler=function(){var e=this;this.$timelineWrap.scroll(function(){+(100*this.scrollLeft/this.scrollWidth/(1-this.clientWidth/this.scrollWidth))>90&&e.addMoreTime()})},e.prototype.setTimelineInput=function(e){function t(e){return(e<10?"0":"")+e}var i=e%1e3,n=(e=(e-i)/1e3)%60,a=t((e=(e-n)/60)%60)+":"+t(n)+":"+("000"+i).substr(-3);this.$timelineInput.val(a)},e.prototype.formatTimelineInputValue=function(e){return(e=e<0?0:e)%100>50?100*Math.ceil(e/100):100*Math.floor(e/100)},e.prototype.timelineInputHandler=function(){var e=this;this.$timelineInput=n.default.getFromTimeline("#timeline-input"),this.$timelineInput.val("00:00:000"),this.$timelineInput.off("blur keyup"),this.$timelineInput.on("blur keyup",function(t){if(t.preventDefault(),t.keyCode!==i.default.Keys.left&&t.keyCode!==i.default.Keys.right&&t.keyCode!==i.default.Keys.ctrl&&t.keyCode!==i.default.Keys.shift&&t.keyCode!==i.default.Keys.up&&t.keyCode!==i.default.Keys.down&&t.keyCode===i.default.Keys.enter){var n,a,o,r=$(this),s=r.val().split(":");1===s.length?(n=0,a=0,s[0]=""===s[0].trim()?0:s[0],o=parseInt(s[0])):2===s.length?(n=0,a=parseInt(s[0]),o=parseInt(s[1])):(n=parseInt(s[0]),a=parseInt(s[1]),o=parseInt(s[2]));var l=o+1e3*a+6e4*n;l=l>3599999?3599999:l,l=e.formatTimelineInputValue(l),e.timelineWidth=e.timelineWidth<l?l:e.timelineWidth,e.setPinheadPosition(null,l),e.setTimelineInput(l),r.blur()}})},e.prototype.rulerScrollLeft=function(){var e=this.$timelineWrap.scrollLeft();this.$timelineWrap.scrollLeft(e-2)},e.prototype.rulerScrollRight=function(e){var t=e||2,i=this.$timelineWrap.scrollLeft();this.$timelineWrap.scrollLeft(i+t)},e.prototype.addMoreTime=function(){this.$timelineEl.width("+=10"),this.originalRulerWidth=this.$timelineEl.width(),this.createTimeline()},e.prototype.calcTimePosition=function(e,t,i,n,a,o){e-=0;var r=i*this.timelineZoom,s=t-r,l=n-a;(e>=s&&e<=s+r||e>=s-r/2&&e<=s)&&this.setPointSeconds(l,s,o)},e.prototype.setPointSeconds=function(e,t,i){this.currentSeconds=e,"timeline-pin"===i[0].id&&(this.pinCurrentSeconds=this.currentSeconds),this.renderPoint(t-this.pinHalfWidth,i)},e.prototype.deleteKeyframe=function(e){var t=n.default.getFromTimeline(".widget-line."+e.className+'[data-property-type="'+e.prop+'"]'),i=this.runtimeEditor.scene,a=i.animations[e.id][e.className],o=a.keyframes[e.group];if(o){var r=o[e.prop];if(delete r[e.time],t.find('[data-current-time="'+e.time+'"]').remove(),$.isEmptyObject(r)&&(delete a.animationsData[e.group][e.prop],delete a.keyframes[e.group][e.prop],r=null,t.remove(),n.default.getFromTimeline(".info-property-name."+e.className+'[data-timeline-info-property-name="'+e.prop+'"]').remove()),$.isEmptyObject(a.keyframes[e.group])&&(delete a.keyframes[e.group],delete a.animationsData[e.group]),$.isEmptyObject(a.keyframes))for(var s in i.animations)i.animations[s][e.className]&&delete i.animations[s][e.className]}var l=this.runtimeEditor.getRedoUndoPrimaryState(),d={seconds:e.time,value:e.value};this.runtimeEditor._sceneActionState.deleteKeyframe=!0,this.runtimeEditor.createUndoRedoCommand(l,e.id,e.group,e.group,e.prop,d),this.runtimeEditor.exportScene(),n.default.getFromTimeline(".info-widgets").getNiceScroll().resize()},e.prototype.deleteSelectedKeyframes=function(){for(var e=this.runtimeEditor.selectedKeyframes.length,t=0;t<e;t++){var i=this.runtimeEditor.selectedKeyframes[t],a=this.getKeyframeWidgetData(i),o=n.default.getFromTimeline('.keyframe[data-animation-class="'+a.className+'"][data-keyframe-property="'+a.prop+'"][data-current-time="'+a.time+'"]').length;this.runtimeEditor._undoCreationStepsLength=o;for(var r in this.runtimeEditor.scene.animations)this.runtimeEditor.scene.animations[r][a.className]&&(a.id=r,this.deleteKeyframe(a))}this.runtimeEditor.selectedKeyframes.length=0},e.prototype.deleteWidget=function(e){delete this.runtimeEditor.scene.animations[e];var t=n.default.getFromTimeline('[data-timeline-info-widget-id="'+e+'"]'),i=n.default.getFromTimeline('.widgets-keyframes [data-widget-id="'+e+'"]');$(".k-animation-container").has('[kendotooltipid="'+e+'"]').remove(),t.remove(),i.remove()},e.prototype.setInputClassName=function(e,t,i){var a=!1;!e&&n.default.getFromTimeline('.animation-class-name-input[data-old-animation-class="'+i+'"]').length>0?n.default.getFromTimeline('.animation-class-name-input[data-old-animation-class="'+i+'"]').val(t):(n.default.getFromTimeline('[data-timeline-info-widget-id="'+e+'"] .animation-class-name-input').val(t),a=!0),this.setOldAnimationClass(e,t,i,a)},e.prototype.removeClassNameFromDOM=function(e,t){t&&""!==t&&(n.default.getFromTimeline('[data-timeline-info-widget-id="'+e+'"] .info-property-name.'+t).remove(),n.default.getFromTimeline('[data-widget-id="'+e+'"] .widget-line.'+t).remove()),this.runtimeEditor.scene.animations[e]&&"new action"===this.runtimeEditor.getRedoUndoPrimaryState()||!a.default.preferences.timeline.filterTimelineWidgets||(n.default.getFromTimeline('[data-timeline-info-widget-id="'+e+'"]').remove(),n.default.getFromTimeline('.widget-line.widget-name-line[data-widget-id="'+e+'"]').remove())},e.prototype.setOldAnimationClass=function(e,t,i,a){!i||a?(n.default.getFromTimeline('[data-timeline-info-widget-id="'+e+'"] [data-old-animation-class]').attr("data-old-animation-class",t),n.default.getFromTimeline('[data-tooltip-change-class-id="'+e+'"] [data-old-animation-class]').attr("data-old-animation-class",t),n.default.getFromTimeline(".k-animation-container").has('[kendotooltipid="'+e+'"]:not([data-tooltip-change-class-id])').remove()):n.default.getFromTimeline('[data-old-animation-class="'+i+'"]').attr("data-old-animation-class",t),this.runtimeEditor.exportScene()},e.prototype.setNewAnimationClass=function(e,t,i){n.default.getFromTimeline("[data-timeline-info-widget-id] ."+i).addClass(t).removeClass(i),n.default.getFromTimeline("[data-widget-id] ."+i).addClass(t).removeClass(i),n.default.getFromTimeline('[data-animation-class="'+i+'"]').attr("data-animation-class",t),n.default.getFromTimeline('.animation-class-name-input[data-old-animation-class="'+i+'"]').val(t)},e.prototype.editAnimationClassNameHandler=function(e){function t(t){var i=t.attr("data-old-animation-class"),n=t.val();t.removeClass("input-tracked-focused"),o.runtimeEditor._sceneActionState.primaryAction="new action",o.editAnimationClassName(e,i,n)}var a=n.default.getFromTimeline('[data-timeline-info-widget-id="'+e+'"] .animation-class-name-input'),o=this;a.off("keypress click focusout"),a.click(function(){$(this).addClass("input-tracked-focused")}).keypress(function(e){if(e.which===i.default.Keys.enter)$(this).blur();else if(e.which===i.default.Keys.space)return!1}).focusout(function(){t($(this))});var r=a.data("kendoTooltip");r&&r.destroy(),a.kendoTooltip({autoHide:!0,showOn:"animationClassDuplicate",content:kendo.template('<div kendoTooltipID="'+e+'" class="tooltip-options tooltip-animation-class"><div class="animation-class-dublicate">Class name already exist. </br> Please choose another one.</div></div>'),width:280,height:75,position:"top"})},e.prototype.editWidgetIdHandler=function(e){function t(e){var t=e.val(),i=e.attr("value"),n=o.runtimeEditor.mappedWidgets[i].widget;e.removeClass("input-tracked-focused"),t!==n.id&&(o.runtimeEditor._sceneActionState.primaryAction="new action",o.runtimeEditor._setProperties(n,e,"element-id","id",t))}var a=n.default.getFromTimeline('[data-timeline-info-widget-id="'+e+'"] .info-widget-name'),o=this;a.off("keypress click focusout"),a.click(function(){$(this).addClass("input-tracked-focused")}).keypress(function(e){if(e.which===i.default.Keys.enter)$(this).blur();else if(e.which===i.default.Keys.space)return!1}).focusout(function(){t($(this))})},e.prototype.editAnimationClassName=function(e,t,i){for(var n=a.default.openFiles[a.default.selectedEditor],o=n.tab.filename.endsWith(".component"),r=0;r<n.components.state.opened.length;r++){var s=n.components.state.opened[r];if(a.default.openFiles[s].runtimeEditor.scene.animationClasses[i])return void(i!==t&&this.triggerDuplicateClassError(t,e))}if(o){var l=n.tab.tabWidgetState.instanceOf,d=a.default.openFiles[l];if(JSON.parse(d.file).animationClasses[i])return void(i!==t&&this.triggerDuplicateClassError(t,e))}this.runtimeEditor.scene.animationClasses[i]||i===t?i!==t&&this.triggerDuplicateClassError(t,e):this.runtimeEditor.editAnimationClassName(e,t,i)},e.prototype.triggerDuplicateClassError=function(e,t){var i=n.default.getFromTimeline('[data-timeline-info-widget-id="'+t+'"] .animation-class-name-input');i.trigger("animationClassDuplicate"),i.val(e)},e.prototype.addWidget=function(e,t){var i=this,o=a.default.importHtmlTemplate(this.templateTimelineInfo);o.setAttribute("data-timeline-info-widget-id",e.id),o.firstElementChild.firstElementChild.id="anim-option-"+e.id,o.firstElementChild.firstElementChild.value=n.default.shortenString(e.id),o.firstElementChild.firstElementChild.setAttribute("value",e.id),this.$infoWidgetsSection.append(o);var r=a.default.importHtmlTemplate(this.templateWidgetLine);r.setAttribute("data-widget-id",e.id),r.setAttribute("value",e.id),n.default.getFromTimeline(".widgets-keyframes-stack").append(r),t&&t.initial&&e.className&&e.className.split(" ").filter(function(t){i.runtimeEditor.scene.animationClasses[t]&&i.initAnimationClassName(e.id,"",t,!0)}),this.createToolTipClassName(e.id),this.addAnimationClassHandler(e),this.removeAnimationClassHandler(e),this.create(),this.editWidgetIdHandler(e.id),n.default.getFromTimeline(".info-widgets").getNiceScroll().resize()},e.prototype.initAnimationClassName=function(e,t,a,o,r){void 0===o&&(o=!1),void 0===r&&(r=!1),this.runtimeEditor.scene.animationClasses[a]=this.runtimeEditor.scene.animationClasses[a]||$.extend(!0,{},i.default.newAnimation),this.runtimeEditor.scene.animationClasses[a].className=a,this.runtimeEditor.scene.animations[e]=this.runtimeEditor.scene.animations[e]||{},r||this.runtimeEditor.switchAnimationClassName(e,t,a,void 0,o),this.setInputClassName(e,a);var s=n.default.getFromTimeline('[data-timeline-info-widget-id="'+e+'"]');s.find(".info-class-name").show(),n.default.getFromTimeline('.widget-name-line[data-widget-id="'+e+'"] .keyframe-line-class-name').show(),this.editAnimationClassNameHandler(e),this.editWidgetIdHandler(e),s.find("animation-class-name-input").show()},e.prototype.createToolTipClassName=function(e){function t(e,t,n){var a=o.runtimeEditor.scene.animationClasses;for(var r in a){var s=document.createElement("option");s.value=r,s.innerHTML=r,r===e&&s.setAttribute("selected","selected"),n[0].appendChild(s)}t.append('<span class="animation-library-title">Animations Library</span>'),t.append('<label class="options-name">Animation:</label>'),t.append(n),n.kendoDropDownList({height:"auto",autoBind:!0,animation:!1,filter:"contains",filtering:function(a){o.animationSearchValue=a.filter.value,i(e,t,n)},dataTextField:"animationClass",dataValueField:"value",headerTemplate:"",valueTemplate:"",template:'<span>#: data.animationClass #</span> <a class="ic-remove-animation-class-global fa fa-remove" data-delete-animation-class="#: data.animationClass #"></a>',open:function(){var a=$(".k-list-filter > input");a.val(o.animationSearchValue),a.trigger("keydown"),i(e,t,n)}})}function i(e,i,s){window.requestAnimationFrame(function(){n.default.getFromTimeline('[data-delete-animation-class="select animation"]').remove(),n.default.getFromTimeline(".ic-remove-animation-class-global").off("click"),n.default.getFromTimeline(".ic-remove-animation-class-global").on("click",function(){var n=$(this).attr("data-delete-animation-class");s.data("kendoDropDownList")&&(s.data("kendoDropDownList").close(),s.data("kendoDropDownList").destroy()),i.empty(),o.runtimeEditor._sceneActionState.primaryAction="new action",o.removeAnimationClassName(n);var l=a.default.importHtmlTemplate(r),d=$(l);d.attr("data-old-animation-class",e),t(e,i,d),d.data("kendoDropDownList").open(),o.runtimeEditor.exportScene()})})}var o=this;this.animationSearchValue="";var r=document.querySelector("#animation-class-switch-dropdown"),s=n.default.getFromTimeline('[data-timeline-info-widget-id="'+e+'"] .ic-change-animation-class'),l=s.data("kendoTooltip");l&&l.destroy(),s.kendoTooltip({autoHide:!1,showOn:"click",content:kendo.template('<div kendoTooltipID="'+e+'" class="tooltip-options tooltip-animation-class" data-tooltip-change-class-id="'+e+'"></div>'),width:280,height:75,position:"top",show:function(){var i=$('[data-timeline-info-widget-id="'+e+'"] .info-class-name [data-old-animation-class]').val(),n=$('[data-tooltip-change-class-id="'+e+'"]'),s=a.default.importHtmlTemplate(r),l=$(s);l.attr("data-old-animation-class",i),t(i,n,l),o.attachTooltipChangeClassNameHandlers(l,e)},hide:function(){var t=$('[data-tooltip-change-class-id="'+e+'"]');o.resetTooltipHtml(t),o.animationSearchValue=""}})},e.prototype.resetAllTimeline=function(){$(".info-stack").empty(),$(".widgets-keyframes-stack").empty()},e.prototype._addGlobalAnimationClassName=function(e){this.runtimeEditor.scene.animationClasses[e.className]=e,this.runtimeEditor._sceneActionState.addAnimationClassGlobal=!0,this.runtimeEditor.saveUndoRedo(null,null,null,{className:e.className},null),this.runtimeEditor.Animations.loadKeyframes(this.runtimeEditor.scene.animationClasses,!1,!0)},e.prototype._deleteGlobalAnimationClassName=function(e){var t=this.runtimeEditor.scene.animationClasses[e];delete this.runtimeEditor.scene.animationClasses[e],this.runtimeEditor._sceneActionState.deleteAnimationClassGlobal=!0,this.runtimeEditor.saveUndoRedo(null,null,null,t,null)},e.prototype.removeAnimationClassName=function(e){var t=this.runtimeEditor.scene.animationClasses[e];delete this.runtimeEditor.scene.animationClasses[e];var i,n=this.runtimeEditor.scene.animations,a=1;for(i in n)n[i].className===e&&a++;this.runtimeEditor._undoCreationStepsLength=a,this.runtimeEditor._sceneActionState.deleteAnimationClassGlobal=!0,this.runtimeEditor.saveUndoRedo(null,null,null,t,null);for(i in n)n[i].className===e&&this.removeAnimationClassFromWidget(i,e,!0)},e.prototype.attachTooltipChangeClassNameHandlers=function(e,t){var i=this;e.on("change",function(){i.runtimeEditor._sceneActionState.primaryAction="new action",i.runtimeEditor._sceneActionState.switchAnimationClass=!0;var e=$(this).parents(".tooltip-options").find("select.select-animation-class"),n=e.attr("data-old-animation-class"),a=e.val();"remove-animation-class"!==a?(i.runtimeEditor.scene.animations[t]||i.editAnimationClassNameHandler(t),i.runtimeEditor.switchAnimationClassName(t,n,a)):i.removeAnimationClassFromWidget(t,n,!0),i.runtimeEditor._sceneActionState.switchAnimationClass=!1})},e.prototype.addAnimationClassHandler=function(e){var t=this,i=n.default.getFromTimeline('[data-timeline-info-widget-id="'+e.id+'"] .ic-add-animation-class');i.off("click"),i.on("click",function(){t.runtimeEditor._sceneActionState.addNewAnimationClassName=!0;var i=$(this).parents(".widget-timeline-holder").find(".animation-class-name-input").val(),n=a.default.generateClassName();t.runtimeEditor._sceneActionState.primaryAction="new action",t.runtimeEditor._sceneActionState.switchAnimationClass=!0,t.initAnimationClassName(e.id,i,n)})},e.prototype.removeAnimationClassHandler=function(e){var t=this,i=n.default.getFromTimeline('[data-timeline-info-widget-id="'+e.id+'"] .ic-remove-animation-class');i.off("click"),i.on("click",function(){var i=$(this).parents(".info-class-name").find(".animation-class-name-input").val();t.runtimeEditor._sceneActionState.primaryAction="new action",t.removeAnimationClassFromWidget(e.id,i,!0)})},e.prototype.removeAnimationClassFromWidget=function(e,t,i){var a="";if(delete this.runtimeEditor.scene.animations[e],i){var o=this.runtimeEditor.mappedWidgets[e].widget.className;""===a&&(a=o.replace(t,"").trim())}this.removeClassNameFromDOM(e,t),this.setInputClassName(e,"",t),this.runtimeEditor.setClassName(null,e,a,!1),n.default.getFromTimeline('[data-timeline-info-widget-id="'+e+'"] .info-class-name').hide(),n.default.getFromTimeline('.widget-name-line[data-widget-id="'+e+'"] .keyframe-line-class-name').hide()},e.prototype.getTooltipHtml=function(e){return a.default.Handlebars.compile(l)(e)},e.prototype.resetTooltipHtml=function(e){e.empty(),e.parent().parent().find(".k-list-container.k-popup.k-group.k-reset").remove()},e.prototype.createTooltip=function(e,t,i,n){var a=this,o=e.data("kendoTooltip");o&&o.destroy(),e.kendoTooltip({autoHide:!1,showOn:"click",content:kendo.template('<div class="tooltip-options" kendoTooltipID="'+t.id+'" data-tooltip-id="'+t.id+'" data-tooltip-property-name="'+n+'" data-tooltip-group-name="'+i+'"></div>'),width:280,height:135,position:"top",show:function(){var o=e.parents('[data-timeline-info-widget-id="'+t.id+'"]').find(".animation-class-name-input").val(),r=t[o].animationsData[i][n],s=a.getTooltipHtml(r),l=$('[data-tooltip-id="'+t.id+'"]');l.attr("data-animation-class",o),l.append(s),l.find("select").kendoDropDownList({animation:!1}),a.attachTooltipHandlers(t.id)},hide:function(){var e=$('[data-tooltip-id="'+t.id+'"]');a.resetTooltipHtml(e)}})},e.prototype.attachTooltipHandlers=function(e){var t=this;n.default.getFromTimeline('[data-tooltip-id="'+e+'"] select.animation-timing').on("change",function(e){t.runtimeEditor._sceneActionState.primaryAction="new action";var i=t.collectAnimationData(e);t.setAnimationTiming(i.id,i.group,i.property,i.value,i.className)}),n.default.getFromTimeline('[data-tooltip-id="'+e+'"] input.animation-iteration').on("input",function(e){t.runtimeEditor._sceneActionState.primaryAction="new action";var i=t.collectAnimationData(e);t.setAnimationIteration(i.id,i.group,i.property,i.value,i.className)}),n.default.getFromTimeline('[data-tooltip-id="'+e+'"] input.animation-iteration-loop').on("change",function(i){var a="infinite",o=n.default.getFromTimeline('[data-tooltip-id="'+e+'"] input.animation-iteration');this.checked||(a=o.val()),t.runtimeEditor._sceneActionState.primaryAction="new action";var r=t.collectAnimationData(i);t.setAnimationIteration(r.id,r.group,r.property,a,r.className)}),n.default.getFromTimeline('[data-tooltip-id="'+e+'"] select.animation-direction').on("change",function(e){t.runtimeEditor._sceneActionState.primaryAction="new action";var i=t.collectAnimationData(e);t.setAnimationDirection(i.id,i.group,i.property,i.value,i.className)}),n.default.getFromTimeline('[data-tooltip-id="'+e+'"] input.animation-name').on("input",function(e){t.runtimeEditor._sceneActionState.primaryAction="new action";var i=t.collectAnimationData(e);t.setAnimationName(i.id,i.group,i.property,i.value,i.className)})},e.prototype.collectAnimationData=function(e){var t=$(e.target).parents(".tooltip-options");return{className:t.attr("data-animation-class"),value:$(e.target).val(),id:t.attr("data-tooltip-id"),group:t.attr("data-tooltip-group-name"),property:t.attr("data-tooltip-property-name")}},e.prototype.setAnimationTiming=function(e,t,i,n,a){var o=this.runtimeEditor.scene.animationClasses[a],r={oldValue:o.animationsData[t][i].timing,className:a};if("transform"===t||"-webkit-filter"===t)for(var s in o.animationsData[t])o.animationsData[t][s].timing=n;else o.animationsData[t][i].timing=n;this.runtimeEditor.exportScene(),this.createUndoRedoAnimationOptions(e,t,i,r,"Timing")},e.prototype.setAnimationIteration=function(e,t,i,a,o){var r=this.runtimeEditor.scene.animationClasses[o],s={oldValue:r.animationsData[t][i].iteration,className:o},l=n.default.getFromTimeline('[data-tooltip-id="'+e+'"] input.animation-iteration');if("infinite"===a?l.prop("disabled",!0):l.prop("disabled",!1),"transform"===t||"-webkit-filter"===t)for(var d in r.animationsData[t])r.animationsData[t][d].iteration=a;else r.animationsData[t][i].iteration=a;this.runtimeEditor.exportScene(),this.createUndoRedoAnimationOptions(e,t,i,s,"Iteration")},e.prototype.setAnimationDirection=function(e,t,i,n,a){var o=this.runtimeEditor.scene.animationClasses[a],r={oldValue:o.animationsData[t][i].direction,className:a};if("transform"===t||"-webkit-filter"===t)for(var s in o.animationsData[t])o.animationsData[t][s].direction=n;else o.animationsData[t][i].direction=n;this.runtimeEditor.exportScene(),this.createUndoRedoAnimationOptions(e,t,i,r,"Direction")},e.prototype.setAnimationName=function(e,t,i,n,a){var o=this.runtimeEditor.scene.animationClasses[a],r={oldValue:o.animationsData[t][i].name,className:a};if("transform"===t||"-webkit-filter"===t)for(var s in o.animationsData[t])o.animationsData[t][s].name=n;else o.animationsData[t][i].name=n;this.runtimeEditor.exportScene(),this.createUndoRedoAnimationOptions(e,t,i,r,"Name")},e.prototype.createUndoRedoAnimationOptions=function(e,t,i,n,a){var o=this.runtimeEditor.getRedoUndoPrimaryState(),r={type:a,value:n.oldValue,className:n.className};this.runtimeEditor._sceneActionState.setAnimationOptions=!0,this.runtimeEditor.createUndoRedoCommand(o,e,t,t,i,r)},e.prototype.reinitKendoTooltips=function(e,t,n){if($('[kendoTooltipID="'+e+'"]').attr("kendoTooltipID",t),$('[data-tooltip-id="'+e+'"]').attr("data-tooltip-id",t),$('[data-tooltip-change-class-id="'+e+'"]').attr("data-tooltip-change-class-id",t),this.editAnimationClassNameHandler(t),this.createToolTipClassName(t),n.length>0){var a=$.extend(!0,{},this.runtimeEditor.scene.animations[e]);a.id=t;for(var o=0;o<n.length;o++)for(var r=$(n[o]).find("[data-timeline-info-property-name]"),s=0;s<r.length;s++){var l=$(r[s]).find(".property-name-text").text();if(""!==l){var d=$(r[s]).find('[data-role="tooltip"].animation-options'),m=i.default.WidgetGroups[l];this.createTooltip(d,a,m,l)}}}},e.prototype.editId=function(e,t){var i=n.default.getFromTimeline('[data-timeline-info-widget-id="'+e+'"]'),a=n.default.getFromTimeline('[data-widget-id="'+e+'"]'),o=n.default.getFromTimeline('[data-keyframe-widget-id="'+e+'"]'),r=n.default.getFromTimeline('[data-tooltip-id="'+e+'"]'),s=n.default.getFromTimeline('[data-timeline-info-widget-id="'+e+'"] .info-widget-name');s.val(n.default.shortenString(t)),s.attr("value",n.default.shortenString(t)),i.attr("data-timeline-info-widget-id",t),a.attr("data-widget-id",t),r.attr("data-tooltip-id",t),o.attr("data-keyframe-widget-id",t),this.reinitKendoTooltips(e,t,i)},e}();t.default=c});