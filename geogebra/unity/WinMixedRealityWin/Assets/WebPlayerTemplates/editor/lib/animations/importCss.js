define(["require","exports","./types","../enums","../function_helpers","../../scripts/main"],function(t,r,e,a,n,i){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o;!function(t){function r(t,r){for(var e in t)!function(e){if(!r[e])return"continue";var a=Object.keys(t[e]);a.filter(function(n){if(!r[e].animationsData["-webkit-filter"][n]){var i=r[e].animationsData["-webkit-filter"].filterProperties,o=a.length;r[e].animationsData["-webkit-filter"][a[0]]=i;for(var s=r[e].animationsData["-webkit-filter"][a[0]],f=1;f<o;f++)r[e].animationsData["-webkit-filter"][a[f]]=s;r[e].keyframes["-webkit-filter"]=t[e],delete r[e].animationsData["-webkit-filter"].filterProperties}})}(e);return r}function o(t,r){for(var e in t)r[e]&&(r[e].keyframes.transform=t[e]);return r}function s(t,r,e){switch(e){case"geometry":case"transform":return"rotateZ"!==r||t[r]?t[r]:t.rotate;case"transform-origin":return p(t[r]);case"-webkit-filter":return v(t[e]);case"boxShadow":return y(t["box-shadow"]);case"backgroundColor":return l(t["background-color"]);case"font":return d(t,r);case"styles":return"color"===r?u(t.color):"borderColor"===r?c(t["border-color"]):m(t,r);default:return!1}}function f(t){for(var r=[],e=0;e<t.length;e++){var a=t[e].declarations.transform,i=n.default.createFilterPropertyGroup(a);a=Object.keys(i).map(function(a){if(i[a]){var n=$.extend(!0,{},t[e]);delete n.declarations.transform,n.declarations[a]=i[a],r.push(n)}})}return r}function l(t){return t}function u(t){return t}function c(t){return t}function m(t,r){return t[n.default.convertJsToCssProperty(r)]}function d(t,r){return t[n.default.convertJsToCssProperty(r)]}function p(t){var r=/\(([^)]+)\)/.exec(t);return r?r[1]:t}function v(t){return t}function y(t){return t}function b(t,r){var e=r*(t/100);return parseInt(e.toFixed())}t.importCss=function(t){var r=parser.parse(t);return r=JSON.parse(JSON.stringify(r,null,"\t")),k(r.rulelist)};var k=function(t){for(var n,l,u,c,m={},d=0;d<t.length;d++){if("style"===t[d].type){if(n=t[d].declarations["custom-metadata"],l=t[d].declarations["transforms-metadata"],n){var p=n.substr(1,n.length-2).replace(/\s(?!(\d+(?=px)))/g,"");u=JSON.parse(p)}if(l){var v=l.substr(1,l.length-2).replace(/\s(?!(\d+(=px)))/g,"");c=JSON.parse(v)}var y=t[d].selector,k=t[d].selector.substr(1).trim();y.startsWith("#")&&i.default.animationsBackwardsCompatibility.idsToClasses.push(k);var g=t[d].declarations;m[k]={},m[k].keyframes={},m[k].className=k,m[k].animationsData={},m[k].labels=[],m[k].events={},m[k].belongTo=i.default.animationBelongsTo;for(var h=g["animation-delay"].split(/\,/),w=g["animation-direction"].split(/\,/),D=g["animation-duration"].split(/\,/),x=g["animation-iteration-count"].split(/\,/),O=g["animation-timing-function"].split(/\,/),C=g["animation-name"].split(/\,/),J=h.length,P=0;P<J;P++){var F=parseFloat(h[P]),N=parseFloat(D[P]),S=t[d+P+1].keyframes;-1!==C[P].indexOf("transform_")&&(S=f(S));for(var T=0;T<S.length;T++){var _=e.default(S[T].declarations);"rotate"===_&&(_="rotateZ");var j=a.default.WidgetGroups[_],B=b(parseFloat(S[T].offset),N)+F,G=s(S[T].declarations,_,j);m[k].keyframes[j]=m[k].keyframes[j]||{},m[k].keyframes[j][_]=m[k].keyframes[j][_]||{},m[k].keyframes[j][_][B]=m[k].keyframes[j][_][B]||{};var W=m[k].keyframes[j][_][B];W.values=[G],W.property=_,W.group=j,W.time={seconds:B};var Z=C[P];"transform"===j&&(Z=C[P].replace("combined",_)),m[k].animationsData[j]=m[k].animationsData[j]||{},m[k].animationsData[j][_]={direction:w[P],iteration:x[P],timing:O[P],name:Z}||{}}}}u&&(m=r(u,m)),c&&(m=o(c,m))}return m}}(o||(o={})),r.default=o});